<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Cartera Cripto</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    .crypto {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 400px;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      font-size: 1em;
      margin-top: 5px;
    }
    .info {
      margin-top: 10px;
    }
    .advice {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Mi Cartera Cripto</h1>

  <div id="container"></div>

  <script>
    const criptos = [
      { id: "bitcoin", simbolo: "btc", nombre: "Bitcoin" },
      { id: "ethereum", simbolo: "eth", nombre: "Ethereum" },
      { id: "solana", simbolo: "sol", nombre: "Solana" },
      { id: "dogecoin", simbolo: "doge", nombre: "Dogecoin" }
    ];

    const container = document.getElementById("container");
    const preciosPrevios = {};

    function crearHTML() {
      criptos.forEach(c => {
        container.innerHTML += `
          <div class="crypto" id="${c.simbolo}">
            <h2>${c.nombre}</h2>
            <label>¿Cuánto tienes?</label>
            <input type="number" step="any" id="${c.simbolo}-input" placeholder="0.00" />
            <div class="info" id="${c.simbolo}-info">Cargando precio...</div>
            <div class="advice" id="${c.simbolo}-advice"></div>
          </div>
        `;
      });
    }

    function guardar(c) {
      const val = document.getElementById(`${c}-input`).value;
      localStorage.setItem(`cantidad-${c}`, val);
    }

    function cargar(c) {
      return parseFloat(localStorage.getItem(`cantidad-${c}`)) || 0;
    }

    async function actualizarPrecios() {
      try {
        const ids = criptos.map(c => c.id).join(',');
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=eur`);
        const datos = await res.json();

        criptos.forEach(c => {
          const precio = datos[c.id].eur;
          const cantidad = cargar(c.simbolo);
          const total = precio * cantidad;

          document.getElementById(`${c.simbolo}-info`).innerHTML = `
            Precio actual: ${precio.toFixed(2)} €<br>
            Valor total: ${total.toFixed(2)} €
          `;

          // Asistente para principiantes:
          const anterior = preciosPrevios[c.simbolo];
          let consejo = "Sin cambios relevantes.";
          if (anterior) {
            const variacion = ((precio - anterior) / anterior) * 100;
            if (variacion > 5) consejo = "El precio ha subido bastante. Podrías considerar vender.";
            else if (variacion < -5) consejo = "El precio ha bajado. Si crees en el proyecto, podrías comprar más.";
            else consejo = "Todo estable. Puedes mantener.";
          }
          document.getElementById(`${c.simbolo}-advice`).innerText = consejo;
          preciosPrevios[c.simbolo] = precio;
        });

      } catch (e) {
        container.innerHTML = "Error al cargar datos. Intenta más tarde.";
      }
    }

    crearHTML();

    criptos.forEach(c => {
      const input = document.getElementById(`${c.simbolo}-input`);
      input.value = cargar(c.simbolo);
      input.addEventListener("input", () => {
        guardar(c.simbolo);
        actualizarPrecios();
      });
    });

    actualizarPrecios();
    setInterval(actualizarPrecios, 60000);
  </script>
</body>
</html>
